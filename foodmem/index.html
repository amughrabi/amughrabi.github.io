<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FoodMem Experiments</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet" media="all" />
    <link href="portrait.css" rel="stylesheet" media="(orientation:portrait)" />
    <link href="print.css" rel="stylesheet" media="print" />
    <style>
        .gif-container {
            text-align: center;
        }
        .gif-container img {
            width: 100%;
        }
        .abstract {
            text-align: justify;
        }
        .github-logo {
            position: relative;
            text-align: center;
            margin-top: 20px;
        }
        .github-logo img {
            width: 60px;
            height: auto;
        }
        .github-text {
            text-align: center;
            font-size: 16px;
            color: #333;
        }
        .citation {
            text-align: justify;
            margin-top: 20px;
            margin-bottom: 20px;
            padding: 10px;
            
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="row">
            <div class="col-12 text-center mb-2">
                <h1 class="mb-4">FoodMem: Near Real-time and Precise Food Video Segmentation</h1>
                <!-- <p class="lead mb-4">This webpage shows all the experiments we realized for FoodMem's validation. We recommend zooming in to avoid webpage lag due to the amount of gifs.</p> -->
                <div class="github-logo">
                    <a href="https://github.com/GCVCG/FoodMem">
                        <img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub Logo">
                    </a>
                </div>
                <div class="github-text">
                    <a href="https://github.com/GCVCG/FoodMem">Code</a>
                </div>
        </div>
        <div class="row">
            <div class="col-md-12 text-center">
                <ul class="list-inline">
                    <li>
                        <a href="https://amughrabi.github.io/">
                          Ahmad AlMughrabi
                        </a>
                        </br>Universitat de Barcelona
                    </li>
                    <li>
                        <a href="#">
                            Adrián Galán
                        </a>
                        </br>Universitat de Barcelona
                    </li>
                    <li>
                        <a href="https://ricjm.github.io/">
                            Ricardo Marques
                        </a>
                        </br>Universitat de Barcelona
                    </li>
                    <li>
                        <a href="http://www.ub.edu/cvub/petiaradeva/">
                            Petia Radeva
                        </a>
                        </br>Universitat de Barcelona
                    </li>
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-12 text-center mb-2">
                <div class="abstract">
                    <h2>Abstract</h2>
                    <p>Food segmentation is essential in various research areas such as health, agriculture, and food biotechnology. The ability to segment and track different types of food in images and videos is a growing area of interest in current research. This study introduces the development of a robust framework for high-quality, near-real-time segmentation and tracking of food items in videos, using minimal hardware resources. This advancement addresses real-world challenges, including food volume estimation, calorie estimation, 3D reconstruction, augmented and virtual reality, and digital twins. We present FoodMem, a novel framework designed to segment food items from video sequences of 360-degree unbounded scenes. FoodMem can consistently generate masks of food portions in a video sequence, overcoming the limitations of existing semantic segmentation models, such as flickering and prohibitive inference speeds in video processing contexts. Although these issues can be alleviated by existing memory-based models, which show promise in object-tracking applications due to their performance and speed, they require user input, hindering automation. To address these issues, FoodMem integrates the SETR model to create initial segmentation masks and XMem++, a memory-based tracking model, to monitor food masks in complex scenes. Our framework outperforms current state-of-the-art food segmentation models, yielding superior performance across various conditions, such as camera angles, lighting, reflections, scene complexity, and food diversity. This results in reduced segmentation noise, elimination of artifacts, and completion of missing segments. We also introduce a new annotated food dataset encompassing challenging scenarios absent in previous benchmarks. Extensive experiments conducted on the Nutrition5k and Vegetables \& Fruits datasets demonstrate that FoodMem enhances the state-of-the-art by 2.5% mean average precision in food video segmentation and is 58times faster on average.</p>    
                </div>
            </div>
        </div>
        <div class="row justify-content-center">
            <div class="col-6 text-center">
                <button id="sotaButton" class="btn btn-primary mr-2">SOTA models comparison</button>
                <button id="ablationButton" class="btn btn-secondary">FoodMem ablation study</button>
            </div>
        </div>
        <div class="content mt-4" id="content">
            <div id="sotaContent">
                <!-- GIFs for SOTA models comparison -->
                <div class="row">
                    <div class="col-2 text-center"><strong>Original video</strong></div>
                    <div class="col-2 text-center"><strong>Ground Truth</strong></div>
                    <div class="col-2 text-center"><strong>FoodMem</strong></div>
                    <div class="col-2 text-center"><strong>FoodSAM</strong></div>
                    <div class="col-2 text-center"><strong>DEVA</strong></div>
                    <div class="col-2 text-center"><strong>kMean++</strong></div>
                </div>
                <!-- First row of GIFs -->
                <div class="row mb-3 gif-container" id="sotaGifs">
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551123072/video.gif" alt="Original video" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551123072/gt.gif" alt="Ground truth" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551123072/foodmem1.gif" alt="FoodMem" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551123072/foodsam.gif" alt="FoodSAM" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551123072/deva.gif" alt="DEVA" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551123072/kmean.gif" alt="kMean++" class="lazy" loading="lazy">
                    </div>
                </div>
                <div class="row mb-3 gif-container" id="sotaGifs">
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551141849/video.gif" alt="Original video" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551141849/gt.gif" alt="Ground truth" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551141849/foodmem1.gif" alt="FoodMem" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551141849/foodsam.gif" alt="FoodSAM" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551141849/deva.gif" alt="DEVA" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551141849/kmean.gif" alt="kMean++" class="lazy" loading="lazy">
                    </div>
                </div>
                <div class="row mb-3 gif-container" id="sotaGifs">
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551236981/video.gif" alt="Original video" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551236981/gt.gif" alt="Ground truth" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551236981/foodmem1.gif" alt="FoodMem" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551236981/foodsam.gif" alt="FoodSAM" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551236981/deva.gif" alt="DEVA" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551236981/kmean.gif" alt="kMean++" class="lazy" loading="lazy">
                    </div>
                </div>
                <div class="row mb-3 gif-container" id="sotaGifs">
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551314254/video.gif" alt="Original video" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551314254/gt.gif" alt="Ground truth" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551314254/foodmem1.gif" alt="FoodMem" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551314254/foodsam.gif" alt="FoodSAM" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551314254/deva.gif" alt="DEVA" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551314254/kmean.gif" alt="kMean++" class="lazy" loading="lazy">
                    </div>
                </div>
                    <div class="row mb-3 gif-container" id="sotaGifs">
                        <div class="col-2">
                            <img src="placeholder.gif" data-src="gifs/VolETA/apple/video.gif" alt="Original video" class="lazy" loading="lazy">
                        </div>
                        <div class="col-2">
                            <img src="placeholder.gif" data-src="gifs/VolETA/apple/gt.gif" alt="Ground truth" class="lazy" loading="lazy">
                        </div>
                        <div class="col-2">
                            <img src="placeholder.gif" data-src="gifs/VolETA/apple/foodmem1.gif" alt="FoodMem" class="lazy" loading="lazy">
                        </div>
                        <div class="col-2">
                            <img src="placeholder.gif" data-src="gifs/VolETA/apple/foodsam.gif" alt="FoodSAM" class="lazy" loading="lazy">
                        </div>
                        <div class="col-2">
                            <img src="placeholder.gif" data-src="gifs/VolETA/apple/deva.gif" alt="DEVA" class="lazy" loading="lazy">
                        </div>
                        <div class="col-2">
                            <img src="placeholder.gif" data-src="gifs/VolETA/apple/kmean.gif" alt="kMean++" class="lazy" loading="lazy">
                        </div>
                    </div>
                </div>
            </div>
            <div id="ablationContent" class="d-none">
                <!-- GIFs for FoodMem ablation study -->
                <div class="row">
                    <div class="col-2 text-center"><strong>Original video</strong></div>
                    <div class="col-2 text-center"><strong>Ground Truth</strong></div>
                    <div class="col-2 text-center"><strong>1 mask</strong></div>
                    <div class="col-2 text-center"><strong>3 masks</strong></div>
                    <div class="col-2 text-center"><strong>6 masks</strong></div>
                    <div class="col-2 text-center"><strong>9 masks</strong></div>
                </div>
                <!-- Repeat this block 42 times, changing GIF sources accordingly -->
                <div class="row mb-3 gif-container" id="ablationGifs">
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551123072/video.gif" alt="Original video" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551123072/gt.gif" alt="Ground truth" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551123072/foodmem1.gif" alt="1 mask" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551123072/foodmem3.gif" alt="3 masks" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551123072/foodmem6.gif" alt="6 masks" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551123072/foodmem9.gif" alt="9 masks" class="lazy" loading="lazy">
                    </div>
                </div>
                <div class="row mb-3 gif-container" id="ablationGifs">
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551141849/video.gif" alt="Original video" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551141849/gt.gif" alt="Ground truth" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551141849/foodmem1.gif" alt="1 mask" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551141849/foodmem3.gif" alt="3 masks" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551141849/foodmem6.gif" alt="6 masks" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551141849/foodmem9.gif" alt="9 masks" class="lazy" loading="lazy">
                    </div>
                </div>
                <div class="row mb-3 gif-container" id="ablationGifs">
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551236981/video.gif" alt="Original video" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551236981/gt.gif" alt="Ground truth" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551236981/foodmem1.gif" alt="1 mask" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551236981/foodmem3.gif" alt="3 masks" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551236981/foodmem6.gif" alt="6 masks" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551236981/foodmem9.gif" alt="9 masks" class="lazy" loading="lazy">
                    </div>
                </div>
                <div class="row mb-3 gif-container" id="ablationGifs">
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551314254/video.gif" alt="Original video" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551314254/gt.gif" alt="Ground truth" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551314254/foodmem1.gif" alt="1 mask" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551314254/foodmem3.gif" alt="3 masks" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551314254/foodmem6.gif" alt="6 masks" class="lazy" loading="lazy">
                    </div>
                    <div class="col-2">
                        <img src="placeholder.gif" data-src="gifs/n5k_missing/dish_1551314254/foodmem9.gif" alt="9 masks" class="lazy" loading="lazy">
                    </div>
                </div>
                    <div class="row mb-3 gif-container" id="ablationGifs">
                        <div class="col-2">
                            <img src="placeholder.gif" data-src="gifs/VolETA/apple/video.gif" alt="Original video" class="lazy" loading="lazy">
                        </div>
                        <div class="col-2">
                            <img src="placeholder.gif" data-src="gifs/VolETA/apple/gt.gif" alt="Ground truth" class="lazy" loading="lazy">
                        </div>
                        <div class="col-2">
                            <img src="placeholder.gif" data-src="gifs/VolETA/apple/foodmem1.gif" alt="1 mask" class="lazy" loading="lazy">
                        </div>
                        <div class="col-2">
                            <img src="placeholder.gif" data-src="gifs/VolETA/apple/foodmem3.gif" alt="3 masks" class="lazy" loading="lazy">
                        </div>
                        <div class="col-2">
                            <img src="placeholder.gif" data-src="gifs/VolETA/apple/foodmem6.gif" alt="6 masks" class="lazy" loading="lazy">
                        </div>
                        <div class="col-2">
                            <img src="placeholder.gif" data-src="gifs/VolETA/apple/foodmem9.gif" alt="9 masks" class="lazy" loading="lazy">
                        </div>
                    </div>
                </div>
            <h2>Citation</h2>
            <p>If you want to cite our work, please use this:</p>
            <div class="citation">
                <pre>
                  TBD
                </pre>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        $(document).ready(function() {
                $('#sotaButton').click(function() {
                    $('#sotaContent').show();
                    $('#ablationContent').hide();
                });
                $('#ablationButton').click(function() {
                    $('#sotaContent').hide();
                    $('#ablationContent').show();
                });

                let showMore = false;
                $('#seeMoreButton').click(function() {
                    if (showMore) {
                        $('#sotaGifs2, #ablationGifs2').hide();
                        $(this).text('See more');
                    } else {
                        $('#sotaGifs2, #ablationGifs2').show();
                        $(this).text('See less');
                    }
                    showMore = !showMore;
                });
            });
            document.addEventListener("DOMContentLoaded", function() {
                const lazyImages = document.querySelectorAll('img.lazy');

                if ('IntersectionObserver' in window) {
                    let lazyImageObserver = new IntersectionObserver(function(entries, observer) {
                        entries.forEach(function(entry) {
                            if (entry.isIntersecting) {
                                let lazyImage = entry.target;
                                lazyImage.src = lazyImage.dataset.src;
                                lazyImage.classList.remove('lazy');
                                lazyImageObserver.unobserve(lazyImage);
                            }
                        });
                    });

                    lazyImages.forEach(function(lazyImage) {
                        lazyImageObserver.observe(lazyImage);
                    });
                } else {
                    // Fallback for browsers without IntersectionObserver support
                    let lazyLoadThrottleTimeout;
                    function lazyLoad() {
                        if (lazyLoadThrottleTimeout) {
                            clearTimeout(lazyLoadThrottleTimeout);
                        }

                        lazyLoadThrottleTimeout = setTimeout(function() {
                            let scrollTop = window.pageYOffset;
                            lazyImages.forEach(function(lazyImage) {
                                if (lazyImage.offsetTop < (window.innerHeight + scrollTop)) {
                                    lazyImage.src = lazyImage.dataset.src;
                                    lazyImage.classList.remove('lazy');
                                }
                            });
                            if (lazyImages.length == 0) { 
                                document.removeEventListener("scroll", lazyLoad);
                                window.removeEventListener("resize", lazyLoad);
                                window.removeEventListener("orientationchange", lazyLoad);
                            }
                        }, 20);
                    }

                    document.addEventListener("scroll", lazyLoad);
                    window.addEventListener("resize", lazyLoad);
                    window.addEventListener("orientationchange", lazyLoad);
                }

                // Function to check if an element is in viewport
                function isInViewport(element) {
                    const rect = element.getBoundingClientRect();
                    return (
                        rect.top >= 0 &&
                        rect.left >= 0 &&
                        rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
                        rect.right <= (window.innerWidth || document.documentElement.clientWidth)
                    );
                }

                // Pause GIFs when they are not in viewport
                function pauseGifs() {
                    document.querySelectorAll('.gif-container img').forEach(gif => {
                        if (!isInViewport(gif)) {
                            gif.style.pointerEvents = 'none';               
                        }
                    });
                }

                // Resume GIFs when they are in viewport
                function resumeGifs() {
                    document.querySelectorAll('.gif-container img').forEach(gif => {
                        if (isInViewport(gif)) {
                            gif.style.pointerEvents = 'auto'; 
                        }
                    });
                }

                // Event listeners for scrolling
                window.addEventListener('scroll', () => {
                    pauseGifs();
                    resumeGifs();
                });

                // Initial check when page loads
                document.addEventListener('DOMContentLoaded', () => {
                    pauseGifs();
                    resumeGifs();
                });

                const sotaButton = document.getElementById("sotaButton");
                const ablationButton = document.getElementById("ablationButton");
                const sotaContent = document.getElementById("sotaContent");
                const ablationContent = document.getElementById("ablationContent");

                sotaButton.addEventListener("click", function() {
                    sotaContent.classList.remove("d-none");
                    ablationContent.classList.add("d-none");
                    sotaButton.classList.add("btn-primary");
                    sotaButton.classList.remove("btn-secondary");
                    ablationButton.classList.add("btn-secondary");
                    ablationButton.classList.remove("btn-primary");
                    restartGIFs("sotaGifs");
                });

                ablationButton.addEventListener("click", function() {
                    sotaContent.classList.add("d-none");
                    ablationContent.classList.remove("d-none");
                    ablationButton.classList.add("btn-primary");
                    ablationButton.classList.remove("btn-secondary");
                    sotaButton.classList.add("btn-secondary");
                    sotaButton.classList.remove("btn-primary");
                    restartGIFs("ablationGifs");
                });

                function restartGIFs(containerId) {
                    const gifsContainer = document.getElementById(containerId);
                    const gifs = gifsContainer.querySelectorAll("img");
                    gifs.forEach(function(gif) {
                        gif.src = gif.src;
                    });
                }
            });
    </script>
</body>
</html>
